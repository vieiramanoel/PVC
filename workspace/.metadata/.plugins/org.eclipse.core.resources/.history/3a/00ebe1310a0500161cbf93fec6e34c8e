#include "PointClickDistance.hpp"
#include <iostream>

int main(int argc, char** argv){
    PointClickDistance windowClick;

    cv::VideoCapture cap(1);
    cv::Mat distortionMat, intrinsicsMat;
    cv::Mat mapx, mapy, frame;
    std::string distortion = "Distortion.xml";
    std::string intrinsics = "Intrinsics.xml";

    //windowClick.gettingROI();
    //windowClick.getDistance();
    cap >> frame;
    cv::FileStorage dstfs(distortion, cv::FileStorage::READ);
    dstfs["Distortion"] >> distortionMat;
    dstfs.release();

    cv::FileStorage intrfs(intrinsics, cv::FileStorage::READ);
    intrfs["Intrinsics"] >> intrinsicsMat;
    intrfs.release();
    cv::Mat emptyR;
    mapx.create(frame.size(), CV_32FC1);
    mapy.create(frame.size(), CV_32FC1);
    cv::initUndistortRectifyMap(intrinsicsMat, distortionMat, emptyR, intrinsicsMat,frame.size(), CV_32FC1, mapx, mapy);
    cv::namedWindow("remaped window", 1);
    while(true){
    	cv::Mat img;
    	cv::remap(frame, img, mapx, mapy, CV_INTER_LINEAR, cv::BORDER_CONSTANT, cv::Scalar(0,0, 0));
    	if (cv::waitKey(30) >= 30) break;
    }
    return 0;
}
